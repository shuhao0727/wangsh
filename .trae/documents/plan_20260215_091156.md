# IT 实验室：Python 可视化与积木编程板块规划

## 1. 核心目标
在现有的 IT 技术实验室中新增一个“Python 编程实验室”板块，包含两个子功能：
1.  **代码可视化 (Trace View)**：输入 Python 代码，逐步展示变量变化和执行流程（解决教学难点：循环/递归理解）。
2.  **积木编程 (Blockly)**：通过拖拽积木生成 Python 代码并运行（降低入门门槛，支持自定义算法结构）。

同时，在后台管理系统中增加该板块的可见性开关。

## 2. 实施方案

### 2.1 前端改造 (`/it-technology`)
**文件**: `frontend/src/pages/ITTechnology/index.tsx`
*   **新增入口卡片**: 在现有“随机点名”、“问卷调查”旁新增“Python 实验室”卡片。
*   **状态管理**: 增加 `python-lab` 视图状态。
*   **路由/组件**: 当点击卡片时，渲染新的子组件 `PythonLab`。
    *   **PythonLab 组件结构**:
        *   顶部 Tab 切换：[积木模式] | [代码模式]
        *   **积木模式**: 集成 `Blockly` 工作区，实时生成 Python 代码。
        *   **代码模式**: 集成 `Monaco Editor`，支持手动输入。
        *   **执行面板**: 展示“运行”、“单步调试”按钮，以及变量追踪视图。

### 2.2 后台管理改造 (`/admin/it-technology`)
**文件**: `frontend/src/pages/Admin/ITTechnology/index.tsx`
*   **新增配置项**: 在 `appConfigs` 数组中增加 `it_python_lab` 配置。
*   **功能开关**: 对应 Feature Flag Key 为 `it_python_lab_enabled`。
*   **管理功能**: 暂无数据管理需求（纯前端工具），仅需控制可见性。

### 2.3 技术架构 (WebAssembly)
为了保证响应速度并降低服务器压力，采用 **纯前端执行** 方案：
*   **执行引擎**: 使用 **Pyodide** (WebAssembly) 在浏览器端运行 Python。
*   **可视化追踪**: 移植开源库 `birdseye` 或编写自定义 `sys.settrace` 钩子，捕获每一步的帧数据（行号、局部变量）。
*   **积木库**: 使用 Google 的 `blockly` npm 包，配置 Python 生成器。

## 3. 可行性与风险论证

### 3.1 可行性
*   **技术成熟度**: Pyodide 已非常成熟，支持 numpy/pandas，足以覆盖基础教学（for/while/递归）。Blockly 是业界标准。
*   **架构兼容**: 现有 React 架构完全支持引入 WASM 和各类 UI 组件库。
*   **无需后端变动**: 除非需要保存学生代码，否则不需要修改后端数据库，开发周期短，风险低。

### 3.2 潜在风险与对策
*   **加载体积**: Pyodide 首次加载约 10MB+。
    *   *对策*: 使用 CDN 加载，并配置浏览器缓存；在进入“Python 实验室”时显示加载进度条。
*   **性能限制**: 浏览器端运行死循环会导致页面卡死。
    *   *对策*: 在执行线程中注入中断检查（Instruction limit），防止无限循环。
*   **移动端适配**: Blockly 在手机上操作困难。
    *   *对策*: 建议主要适配 PC/Pad 端，移动端仅作代码查看。

## 4. 执行计划 (Milestones)

1.  **后台配置 (Admin)**: 修改管理页，添加 `it_python_lab` 开关，确保管理员可控制入口显示。
2.  **前端入口 (User)**: 修改用户页，根据开关显示新卡片。
3.  **原型开发 (Prototype)**:
    *   集成 Pyodide，实现简单的“输入代码 -> 运行输出”。
    *   集成 Blockly，实现“积木 -> 代码”转换。
4.  **可视化增强 (Advanced)**: 开发变量追踪面板，实现“单步调试”效果。

请确认是否按照此规划开始执行？首步将从**后台配置**和**前端入口**开始。
