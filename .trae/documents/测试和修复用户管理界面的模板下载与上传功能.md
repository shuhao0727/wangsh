# 用户管理界面功能测试与完善计划

基于代码分析，我发现用户管理界面的模板下载和上传功能需要测试和完善：

## 当前状态分析

### 1. 下载模板功能 ✅ 已实现（但有改进空间）
- **前端实现**：在 `useUsers.ts` 中的 `handleDownloadTemplate` 函数
- **模板内容**：目前只有表头 `学号,姓名,学年,班级,状态`
- **问题**：缺少示例数据，用户不知道应该填写什么格式

### 2. 上传用户功能 ⚠️ 部分实现
- **前端实现**：有上传按钮和 `handleFileUpload` 函数
- **后端API**：❌ 未实现用户导入API
- **当前状态**：前端只是模拟上传，没有实际后端调用

## 实施计划

### 第一阶段：测试现有功能
1. **测试模板下载**：访问用户管理界面，点击"下载模板"按钮，确认是否能下载 `user_import_template.csv` 文件
2. **测试模拟上传**：尝试上传文件，观察前端提示消息（应该显示"文件上传成功（模拟）"）

### 第二阶段：完善模板内容
1. **丰富模板示例**：在模板中添加2-3行示例数据，展示正确格式
2. **改进下载函数**：更新 `handleDownloadTemplate` 函数，添加更多示例数据

### 第三阶段：实现后端导入API
1. **设计API接口**：在 `users.py` 中添加 `/users/import` API端点
2. **实现文件解析**：支持CSV/Excel文件解析
3. **添加批量创建**：调用现有用户创建逻辑批量导入用户
4. **错误处理**：记录导入失败的行和原因

### 第四阶段：集成前后端
1. **更新前端服务**：在 `users/index.ts` 中添加用户导入API调用
2. **更新hook**：将 `handleFileUpload` 连接到真实的后端API
3. **添加进度反馈**：显示导入进度和结果统计

## 预期交付物

1. ✅ 包含示例数据的完整模板文件
2. ✅ 可工作的用户导入API端点
3. ✅ 完整的前后端集成
4. ✅ 详细的错误处理和用户反馈

## 模板改进建议

建议的模板内容：
```
学号,姓名,学年,班级,状态,角色代码,用户名
20230001,张三,2025,高一(1)班,true,student,zhangsan
20230002,李四,2025,高一(2)班,true,student,lisi
20230003,王五,2025,高一(3)班,false,student,wangwu
20240001,管理员,2024,null,true,admin,admin_user
```

其中状态应为 `true`（激活）或 `false`（未激活），角色代码可以是 `student`、`admin` 或 `super_admin`。

## 技术实现要点

1. **CSV解析**：使用前端 `FileReader` 或后端Python的 `csv` 模块
2. **批量操作**：使用数据库事务确保数据一致性
3. **数据验证**：检查学号/用户名的唯一性，验证必填字段
4. **进度反馈**：对于大量数据，分批次处理并提供进度更新