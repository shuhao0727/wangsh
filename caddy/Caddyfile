# WangSh 开发环境 Caddy 配置 (使用Caddy原生环境变量语法)
{
    admin off
    log {
        output file /data/access.log
        level INFO
    }
    auto_https off
}

:8080 {
    handle /docs* {
        reverse_proxy http://{$BACKEND_HOST}:{$BACKEND_PORT} {
            health_uri /health
            health_interval 10s
            health_timeout 2s
        }
    }

    handle /redoc* {
        reverse_proxy http://{$BACKEND_HOST}:{$BACKEND_PORT} {
            health_uri /health
            health_interval 10s
            health_timeout 2s
        }
    }

    handle /api/v1/* {
        reverse_proxy http://{$BACKEND_HOST}:{$BACKEND_PORT} {
            health_uri /health
            health_interval 10s
            health_timeout 2s
        }
    }

    handle /api/* {
        uri strip_prefix /api
        reverse_proxy http://{$BACKEND_HOST}:{$BACKEND_PORT} {
            health_uri /health
            health_interval 10s
            health_timeout 2s
        }
    }

    # 健康检查端点
    handle /health {
        reverse_proxy http://{$BACKEND_HOST}:{$BACKEND_PORT} {
            health_uri /health
            health_interval 10s
            health_timeout 2s
        }
    }

    # 前端路由：所有其他请求转发到前端开发服务器
    handle {
        # 直接代理到前端React开发服务器
        reverse_proxy http://{$FRONTEND_HOST}:{$FRONTEND_PORT} {
            # 前端健康检查配置
            health_uri /
            health_interval 10s
            health_timeout 3s
        }
    }
}
